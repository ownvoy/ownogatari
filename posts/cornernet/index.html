<!DOCTYPE html>
<html lang="en" dir="auto">

<head>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://ownogatari.xyz/" accesskey="h" title="미래사회와 창의혁신인재 (Alt + H)">미래사회와 창의혁신인재</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://ownogatari.xyz/categories/" title="categories">
                    <span>categories</span>
                </a>
            </li>
            <li>
                <a href="https://ownogatari.xyz/tags/" title="tags">
                    <span>tags</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://ownogatari.xyz/">Home</a>&nbsp;»&nbsp;<a href="https://ownogatari.xyz/posts/">Posts</a></div>
    <h1 class="post-title">
      CornerNet
    </h1>
    <div class="post-meta"><span title='2024-01-02 15:06:43 +0900 +0900'>January 2, 2024</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;271 words&nbsp;·&nbsp;Won Jun Oh

</div>
  </header> 
  <div class="post-content"><h1 id="1-overview">1. overview<a hidden class="anchor" aria-hidden="true" href="#1-overview">#</a></h1>
<h2 id="11-objective">1.1 objective<a hidden class="anchor" aria-hidden="true" href="#11-objective">#</a></h2>
<ul>
<li>anchor box를 없애보자.</li>
</ul>
<h2 id="12-background">1.2 background<a hidden class="anchor" aria-hidden="true" href="#12-background">#</a></h2>
<h3 id="121-anchor-box의-문제점">1.2.1 anchor box의 문제점<a hidden class="anchor" aria-hidden="true" href="#121-anchor-box의-문제점">#</a></h3>
<ol>
<li>너무 많은 수의 anchor box (ex. DSS에는 40k 이상, RetinaNet에는 100k 이상) \(\Rightarrow\) positive sample과 negative sample의 imbalance가 training 속도 느리게 함.</li>
<li>hyperparameter \(\uparrow\) (ex. ratio, box size, feature map size)</li>
</ol>
<h1 id="2-main">2. main<a hidden class="anchor" aria-hidden="true" href="#2-main">#</a></h1>
<h2 id="21-architecture">2.1 architecture<a hidden class="anchor" aria-hidden="true" href="#21-architecture">#</a></h2>
<p><img loading="lazy" src="https://github.com/ownvoy/ownogatari/assets/96481582/f7c687b2-d679-41e0-aa02-141f64bd799e" alt="image"  />
</p>
<p>backbone(Hourglass Networ) + prediction Module(Corner pooling, Heatmaps, Embeddings, offsets)으로 이루어져 있다.</p>
<h3 id="211-corner-pooling">2.1.1 Corner pooling<a hidden class="anchor" aria-hidden="true" href="#211-corner-pooling">#</a></h3>
<p><img loading="lazy" src="https://github.com/ownvoy/ownogatari/assets/96481582/93ef350c-4ba7-4a40-8f9d-9aed9be42bce" alt="image"  />

각각의 코너를 top-left corner와 bottom-right corner라 한다.</p>
<p><img loading="lazy" src="https://github.com/ownvoy/ownogatari/assets/96481582/8c405fe6-be7c-402e-9c37-d3117099d1c8" alt="image"  />

주황색 코너를 봐보면, 사람에 대한 local 정보가 없다.
사람에 대한 정보를 얻기 위해서는 오른쪽과 아래 pixele들을 봐야한다. (Top-left 기준)</p>
<p><img loading="lazy" src="https://github.com/ownvoy/ownogatari/assets/96481582/9b47ef2f-5d71-4e57-b75e-0ae3e827dfdd" alt="image"  />

수평과 수직 방향으로 max값들을 취한다. Bottom-Right도 마찬가지로 왼쪽과 위쪽을 봐주면 된다.</p>
<p><img loading="lazy" src="https://github.com/ownvoy/ownogatari/assets/96481582/35c91433-0c18-4b61-bb79-19d92b28e0e7" alt="image"  />
</p>
<p>Corner Pooling을 한 후, backbone의 feqturemap과 다시 residual connect를 해준다.
<img loading="lazy" src="https://github.com/ownvoy/ownogatari/assets/96481582/2a5b9f47-221b-467a-956f-cfb8f8c28a02" alt="image"  />
</p>
<h3 id="212-corners-and-heatmaps">2.1.2 Corners and Heatmaps<a hidden class="anchor" aria-hidden="true" href="#212-corners-and-heatmaps">#</a></h3>
<p>Corner Pooling 후 heatmap과 embedding, offset을 예측한다.</p>
<p><img loading="lazy" src="https://github.com/ownvoy/ownogatari/assets/96481582/3181d7fb-afbe-444e-8c2f-0a06f2e063c6" alt="image"  />
</p>
<ul>
<li>top-left corner와 bottom-right corner에 대한 heatmap이 있다.</li>
<li>각각의 size는 \(C \times W \times H\)(category for \(C\))이다.</li>
</ul>
<p><strong>heatmap에 대한 focal loss</strong></p>
<p><img loading="lazy" src="https://github.com/ownvoy/ownogatari/assets/96481582/6f57c590-b260-4937-afa6-d245a7c8a305" alt="image"  />
</p>
<ul>
<li>\(p_{cij}\): \(c\)에 대한 prediction</li>
<li>\(y_{cij}\): \(c\)에 대한 ground truth</li>
<li>negative sample: 덜 중요한 sample이니 가중치 많이 줄임.</li>
<li>negative이면서 corner와 가까운 sample: 정답과 가까이 있으니까, 가중치 적당히 줄임.</li>
<li>positive sample: 중요한 sample이니 가중치 조금만 줄임.</li>
</ul>
<h3 id="213-grouping-corners-and-embeddings">2.1.3 Grouping Corners and Embeddings<a hidden class="anchor" aria-hidden="true" href="#213-grouping-corners-and-embeddings">#</a></h3>
<p><img loading="lazy" src="https://github.com/ownvoy/ownogatari/assets/96481582/7fff9950-8626-43fd-aa5f-f2a13f3c2e83" alt="image"  />

여러 개의 object가 있을 때에는 각각의 쌍을 맞춰줘야 한다.
\(\Rightarrow\)각 포인트의 임베딩 벡터로 유사도 구한 후, distance 측정.</p>
<p>$$L_{p u l l}=\frac{1}{N}\sum_{k=1}^{N}\left[\left(e_{t_{k}}-e_{k}\right)^{2}+\left(e_{b_{k}}-e_{k}\right)^{2}\right]$$
같은 group은 pull(비슷하게)하도록 학습한다.</p>
<p>$$L_{p u s h}=\frac1{N(N-1)}\sum_{k=1}^{N}\sum_{\stackrel{j=1}{j\neq k}}^{N}\operatorname*{max}\left(0,\Delta-\vert e_{k}-e_{j}\vert\right)$$
다른 group은 psuh(멀어지게)하도록 학습한다.</p>
<h3 id="214-offset">2.1.4 Offset<a hidden class="anchor" aria-hidden="true" href="#214-offset">#</a></h3>
<p>offset은 corner의 정확한 위치를 조정한다.</p>
<p><strong>offset에 대한 loss</strong></p>
<p>$$L_{off}=\frac{1}{N}\sum_{k=1}^{N}\mathrm{SmoothL1Loss}\left(o_{k},\hat{o}_{k}\right)$$</p>
<p><strong>최종 loss</strong></p>
<p>$$L=L_{det}+\alpha L_{pull}+\beta L_{push}+\gamma L_{off}$$</p>
<h1 id="3-experiments">3. experiments<a hidden class="anchor" aria-hidden="true" href="#3-experiments">#</a></h1>
<p><img loading="lazy" src="https://github.com/ownvoy/ownogatari/assets/96481582/3a6f439b-5985-4e7c-a172-ad0cf8453913" alt="image"  />

RetinaNet의 경우 one-stage detector보다는 다 좋고, two-stage detector와는 비등비등하다.</p>
<p><img loading="lazy" src="https://github.com/ownvoy/ownogatari/assets/96481582/15335eb7-8a2c-4df0-a0d8-828824f77612" alt="image"  />

corner pooling시 object의 보다 정확한 box를 구하는 것을 확인 할 수 있다. 특히 큰 물체와 관련하여서, 점수가 좋다.</p>
<p><img loading="lazy" src="https://github.com/ownvoy/ownogatari/assets/96481582/dee1457d-eddf-4976-a0c6-b6e26ac9bc71" alt="image"  />
</p>
<p>그러나, corner를 잘못 잡거나 embedding이 올바르지 않을 때에는 error를 보여준다.</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://ownogatari.xyz/tags/cv/">CV</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://ownogatari.xyz/posts/retinanet/">
    <span class="title">« Prev</span>
    <br>
    <span>RetinaNet</span>
  </a>
  <a class="next" href="https://ownogatari.xyz/posts/fpn/">
    <span class="title">Next »</span>
    <br>
    <span>FPN</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2024 <a href="https://ownogatari.xyz/">미래사회와 창의혁신인재</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
